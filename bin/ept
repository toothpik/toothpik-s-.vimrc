#!/usr/bin/perl
#  examine previous transactions - designed for gas and electric
$na = @ARGV;
if ($na == 0) {
    $t = 'Power & Light';
} elsif ($ARGV[0] eq 'g') {
    $t = 'Gas Energy';
} else {
    $t = "$ARGV[0]";
}
$h = $ENV{'HOME'};
$bcnt = 0;
for ($y = 2004; $y < 2016; $y++) {
    $F = "$h/txt/plan_$y";
    $sof = open(PLN, "<$F");
    if (!$sof) {
        die "cannot open $F";
    }
    $tot = 0;
    $cnt = 0;
    while ($_ = <PLN>) {
        chop;
        if (/$t/) {
            $tr = substr($_, 47, 10);
            $tr =~ s/ //g;
            $tot += $tr;
            ++$cnt;
            $table{"$y". "-" . "$cnt"} = $tr;
        }
    }
    close(PLN);
   if ($cnt > $bcnt) {
       $bcnt = $cnt;
    }
    $table{"$y" . "-tot"} = $tot;
}
printf "%47s\n", $t;
print "       2004    2005    2006    2007    2008    2009    2010    2011    2012    2013    2014    2015\n";
for ($m = 1; $m < $bcnt + 1; $m++) {
    printf "%2d)  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f  %6.2f\n", $m, $table{"2004-" . "$m"}, $table{"2005-" . "$m"}, $table{"2006-" . "$m"}, $table{"2007-" . "$m"}, $table{"2008-" . "$m"}, $table{"2009-"."$m"}, $table{"2010-"."$m"}, $table{"2011-"."$m"}, $table{"2012-"."$m"}, $table{"2013-"."$m"}, $table{"2014-"."$m"}, $table{"2015-"."$m"};
}
print "     ======  ======  ======  ======  ======  ======  ======  ======  ======  ======  ======  ======\n";
printf "    %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f %7.2f\n", $table{"2004-tot"}, $table{"2005-tot"}, $table{"2006-tot"}, $table{"2007-tot"}, $table{"2008-tot"}, $table{"2009-tot"}, $table{"2010-tot"}, $table{"2011-tot"}, $table{"2012-tot"}, $table{"2013-tot"}, $table{"2014-tot"}, $table{"2015-tot"};
